<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Brosur Jadwal Dokter - Kumpulan Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .montserrat { font-family: 'Montserrat', sans-serif; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex flex-col">

    <!-- Navigasi yang sama dengan aplikasi sebelumnya -->
    <nav class="bg-white shadow-md w-full flex-shrink-0">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="font-bold text-xl text-slate-800">Kumpulan Tools</span>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-slate-500 hover:bg-slate-100 hover:text-slate-900 rounded-md px-3 py-2 text-sm font-medium">Design Story Cuti Dokter</a>
                        <a href="brochure-generator.html" class="bg-blue-600 text-white rounded-md px-3 py-2 text-sm font-medium" aria-current="page">Brochure Jadwal Dokter</a>
                        <a href="#" class="text-slate-500 hover:bg-slate-100 hover:text-slate-900 rounded-md px-3 py-2 text-sm font-medium">Public Holiday Operational</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow flex items-center justify-center">
        <div class="w-full max-w-lg bg-white p-8 shadow-xl rounded-2xl text-center">
            
            <div id="initial-state">
                <h1 class="text-3xl font-bold text-slate-800 mb-2">Generator Brosur Trifold</h1>
                <p class="text-slate-500 mb-8">Buat PDF jadwal dokter dalam format brosur lipat tiga (trifold) berdasarkan data terbaru dari Google Sheets.</p>
                <button id="generate-button" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-lg hover:bg-blue-700 disabled:bg-slate-400 transition-colors text-lg">
                    <span>Mulai Generate PDF Brosur</span>
                </button>
            </div>

            <div id="loading-state" class="hidden text-center py-8">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                <p class="mt-4 text-slate-600">Sedang memproses...<br>Proses ini mungkin memakan waktu hingga 30 detik. Mohon tunggu.</p>
            </div>

            <div id="success-state" class="hidden text-center py-8">
                <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h2 class="text-2xl font-bold text-slate-800">Berhasil!</h2>
                <p class="text-slate-600 mt-2">PDF Brosur telah berhasil dibuat dan akan segera terunduh.</p>
                <button id="generate-again-button" class="mt-6 bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">
                    Buat Lagi
                </button>
            </div>

            <div id="error-state" class="hidden text-center py-8 bg-red-50 border-l-4 border-red-400 p-4">
                <p class="font-bold text-red-800">Gagal Membuat Brosur</p>
                <p class="text-sm text-red-600">Terjadi kesalahan di server. Coba lagi nanti atau periksa log Netlify Function.</p>
            </div>

        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // URL ke fungsi Netlify yang akan kita buat
    const GENERATE_BROCHURE_URL = '/.netlify/functions/generate-brochure';

    const initialState = document.getElementById('initial-state');
    const loadingState = document.getElementById('loading-state');
    const successState = document.getElementById('success-state');
    const errorState = document.getElementById('error-state');
    const generateButton = document.getElementById('generate-button');
    const generateAgainButton = document.getElementById('generate-again-button');

    function setState(state) {
        initialState.classList.add('hidden');
        loadingState.classList.add('hidden');
        successState.classList.add('hidden');
        errorState.classList.add('hidden');

        if (state === 'initial') initialState.classList.remove('hidden');
        else if (state === 'loading') loadingState.classList.remove('hidden');
        else if (state === 'success') successState.classList.remove('hidden');
        else if (state === 'error') errorState.classList.remove('hidden');
    }

    async function generateBrochure() {
        setState('loading');
        
        try {
            // Memanggil fungsi backend. Fetch API digunakan untuk mengambil PDF.
            const response = await fetch(GENERATE_BROCHURE_URL);

            if (!response.ok) {
                throw new Error(`Server error: ${response.statusText}`);
            }

            // Mengambil blob (file biner) dari response
            const pdfBlob = await response.blob();
            
            // Membuat URL sementara untuk blob agar bisa diunduh
            const downloadUrl = window.URL.createObjectURL(pdfBlob);
            
            // Membuat elemen link tersembunyi untuk memicu unduhan
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = downloadUrl;
            
            // Menentukan nama file saat diunduh
            const date = new Date();
            const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            a.download = `Jadwal-Dokter-Siloam-Ambon-${formattedDate}.pdf`;
            
            document.body.appendChild(a);
            a.click();
            
            // Membersihkan URL object setelah diunduh
            window.URL.revokeObjectURL(downloadUrl);
            a.remove();

            setState('success');

        } catch (error) {
            console.error('Failed to generate brochure:', error);
            setState('error');
        }
    }

    generateButton.addEventListener('click', generateBrochure);
    generateAgainButton.addEventListener('click', () => setState('initial'));

    setState('initial');
});
</script>
</body>
</html>

